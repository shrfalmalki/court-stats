<!doctype html>
<html lang="ar" dir="rtl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ† - Ø§Ù„Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø¬Ø²Ø§Ø¦ÙŠØ©</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Akhbar:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box; margin: 0; padding: 0;
      font-family: 'Akhbar', 'Segoe UI', Tahoma, sans-serif;
      background: #f0f8ff; overflow-x: hidden;
    }
    .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
    .official-header {
      background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px);
      border: 2px solid rgba(55, 151, 119, 0.3); border-radius: 20px;
      padding: 30px; margin-bottom: 20px; text-align: right;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    .official-title { font-size: 22px; font-weight: 700; color: #000; }
    .header {
      background: rgba(55, 151, 119, 0.85); color: white;
      padding: 25px; border-radius: 20px; margin-bottom: 25px; text-align: center;
    }
    .nav-tab {
      background: rgba(255, 255, 255, 0.15); color: white;
      padding: 10px 20px; border-radius: 10px; cursor: pointer; transition: 0.3s;
      border: 1px solid rgba(255, 255, 255, 0.3); margin: 5px;
    }
    .nav-tab.active { background: white; color: #379777; font-weight: bold; }
    .page { display: none; animation: fadeIn 0.4s ease; }
    .page.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .card { background: white; border-radius: 20px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
    .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
    .btn { padding: 10px 25px; border-radius: 8px; cursor: pointer; border: none; font-weight: bold; }
    .btn-primary { background: #379777; color: white; }
    .stat-card { padding: 20px; border-radius: 15px; color: white; text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
    th, td { padding: 12px; border: 1px solid #eee; text-align: right; }
    thead { background: #379777; color: white; }
    .loading-overlay { 
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        background: rgba(255,255,255,0.8); display: none; justify-content: center; 
        align-items: center; z-index: 1000; font-weight: bold;
    }
  </style>
 </head>
 <body>

  <div id="loading" class="loading-overlay">Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>

  <div class="container">
    <div class="official-header">
      <div class="official-title">Ø§Ù„Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø¬Ø²Ø§Ø¦ÙŠØ© Ø¨Ù…Ø­Ø§ÙØ¸Ø© Ø¬Ø¯Ø©</div>
      <div class="text-lg">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø¹Ø§ÙˆÙ‰ ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù… - Ù‚Ø³Ù… Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ†</div>
    </div>

    <div class="header">
      <h1 class="text-3xl font-bold mb-4">Ù†Ø¸Ø§Ù… Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ† Ø§Ù„Ø°ÙƒÙŠ</h1>
      <div class="flex flex-wrap justify-center no-print">
        <button class="nav-tab active" onclick="showPage('charts')">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
        <button class="nav-tab" onclick="showPage('data')">ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <button class="nav-tab" onclick="showPage('entry')">â• Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯</button>
      </div>
    </div>

    <div id="page-charts" class="page active">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div class="stat-card" style="background: #379777;">
            <div class="text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ÙŠÙ†</div>
            <div id="total-count" class="text-3xl font-bold">0</div>
        </div>
        </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="card">
            <h3 class="font-bold mb-4 border-b pb-2 text-green-700">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ÙŠÙ† Ø­Ø³Ø¨ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©</h3>
            <canvas id="deptChart" height="200"></canvas>
        </div>
        <div class="card">
            <h3 class="font-bold mb-4 border-b pb-2 text-green-700">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ÙŠÙ† Ø­Ø³Ø¨ Ø§Ù„ØµÙØ©</h3>
            <canvas id="capChart" height="200"></canvas>
        </div>
      </div>
    </div>

    <div id="page-data" class="page">
      <div class="card overflow-x-auto">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">Ø³Ø¬Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</h2>
            <button class="btn btn-primary" onclick="loadData()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>
        <table id="dataTable">
          <thead>
            <tr>
              <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
              <th>Ø§Ù„Ù…Ø³ØªÙÙŠØ¯</th>
              <th>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</th>
              <th>Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©</th>
              <th>Ø³Ø¨Ø¨ Ø§Ù„Ø²ÙŠØ§Ø±Ø©</th>
              <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
            </tr>
          </thead>
          <tbody>
            </tbody>
        </table>
      </div>
    </div>

    <div id="page-entry" class="page">
      <div class="card max-w-2xl mx-auto">
        <h2 class="text-2xl font-bold text-green-700 mb-6 border-b pb-2">ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ù…Ø¹Ø§Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
        <form id="dataForm">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="form-group"><label>Ø§Ù„ÙŠÙˆÙ…</label><select id="day" required><option>Ø§Ù„Ø£Ø­Ø¯</option><option>Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</option><option>Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option><option>Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option><option>Ø§Ù„Ø®Ù…ÙŠØ³</option></select></div>
            <div class="form-group"><label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label><input type="date" id="date" required></div>
            <div class="form-group"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯</label><input type="text" id="beneficiary_name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ"></div>
            <div class="form-group"><label>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</label><input type="text" id="id_number"></div>
            <div class="form-group"><label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label><input type="tel" id="phone_number"></div>
            <div class="form-group"><label>Ø±Ù‚Ù… Ø§Ù„Ù‚Ø¶ÙŠØ©</label><input type="text" id="case_number"></div>
            <div class="form-group"><label>Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©</label><select id="department"><option>Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</option><option>Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</option><option>Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©</option><option>Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©</option><option>Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø®Ø§Ù…Ø³Ø©</option><option>Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</option><option>ØºÙŠØ± Ù…Ù‚ÙŠØ¯</option></select></div>
            <div class="form-group"><label>Ø§Ù„ØµÙØ©</label><select id="capacity"><option>Ø£ØµÙŠÙ„ Ù…Ø¯Ø¹ÙŠ</option><option>Ø£ØµÙŠÙ„ Ù…Ø¯Ø¹Ù‰ Ø¹Ù„ÙŠÙ‡</option><option>ÙˆÙƒÙŠÙ„</option><option>Ù…Ø­Ø§Ù…ÙŠ</option><option>Ø´Ø§Ù‡Ø¯</option></select></div>
            <div class="form-group md:col-span-2"><label>Ø³Ø¨Ø¨ Ø§Ù„Ø²ÙŠØ§Ø±Ø©</label><select id="description"><option>Ø·Ù„Ø¨ Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ Ù…Ù„Ù</option><option>Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ù…ÙˆØ¹Ø¯</option><option>ØªØ³Ù„ÙŠÙ… Ø¨ÙŠÙ†Ø©</option><option>ØªÙ‚Ø¯ÙŠÙ… Ø´ÙƒÙˆÙ‰</option><option>Ø·Ù„Ø¨ Ø±Ø§Ø¨Ø· Ø¬Ù„Ø³Ø©</option></select></div>
            <div class="form-group md:col-span-2"><label>Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø®ØªØµ</label><select id="employee"><option>Ø¹Ù„ÙŠ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ</option><option>Ù…Ø­Ù…Ø¯ Ø§Ù„Ø«Ø¨ÙŠØªÙŠ</option><option>ÙÙŠØµÙ„ Ø§Ù„Ø¬Ù‡Ù†ÙŠ</option><option>Ù…ØªØ¹Ø¨ Ø§Ù„ØµØ§Ø¹Ø¯ÙŠ</option><option>Ø£ÙƒØ±Ù… Ø§Ù„ØµØ¨Ø­ÙŠ</option></select></div>
          </div>
          <button type="submit" class="btn btn-primary w-full mt-4 py-3 text-lg">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Google Sheets</button>
        </form>
      </div>
    </div>

    <footer class="mt-10 text-center text-gray-500 text-sm border-t pt-4">
        Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2024 - ØªØµÙ…ÙŠÙ… Ø´Ø±Ù Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ
    </footer>
  </div>

  <script>
    // -------------------------------------------------------------------------
    // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø¨Ø· - Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ø±Ø§Ø¨Ø· Web App URL Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
    // -------------------------------------------------------------------------
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxjGFsxXiOdz9iEvV2YCgXAqm1_r2T7CO5sW0JwgEkFi0TOKK3Lp_Y491VQ4Q0NAMUAxQ/exec'; 

    let allData = [];
    let charts = {};

    // ØªÙ†Ù‚Ù„ Ø§Ù„ØµÙØ­Ø§Øª
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
      document.getElementById('page-' + pageId).classList.add('active');
      event.target.classList.add('active');
      if(pageId === 'charts') updateDashboard();
    }

    // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets
    async function loadData() {
      showLoading(true);
      try {
        const response = await fetch(GOOGLE_SCRIPT_URL);
        allData = await response.json();
        updateDataTable();
        updateDashboard();
      } catch (e) {
        alert('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø´Ø± ÙÙŠ Ø¬ÙˆØ¬Ù„');
      }
      showLoading(false);
    }

    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Google Sheets
    document.getElementById('dataForm').onsubmit = async (e) => {
      e.preventDefault();
      showLoading(true);

      const record = {
        day: document.getElementById('day').value,
        date: document.getElementById('date').value,
        beneficiary_name: document.getElementById('beneficiary_name').value,
        id_number: document.getElementById('id_number').value,
        phone_number: document.getElementById('phone_number').value,
        case_number: document.getElementById('case_number').value,
        department: document.getElementById('department').value,
        capacity: document.getElementById('capacity').value,
        description: document.getElementById('description').value,
        employee: document.getElementById('employee').value,
        created_at: new Date().toLocaleString('ar-SA')
      };

      try {
        await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          mode: 'no-cors',
          body: JSON.stringify(record)
        });
        alert('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!');
        document.getElementById('dataForm').reset();
        loadData(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸
      } catch (error) {
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');
      }
      showLoading(false);
    };

    function updateDataTable() {
      const tbody = document.querySelector('#dataTable tbody');
      tbody.innerHTML = allData.map(r => `
        <tr>
          <td>${r.date}</td>
          <td>${r.beneficiary_name}</td>
          <td>${r.id_number}</td>
          <td>${r.department}</td>
          <td>${r.description}</td>
          <td>${r.employee}</td>
        </tr>
      `).join('');
    }

    function updateDashboard() {
      document.getElementById('total-count').innerText = allData.length;
      
      const depts = {}, caps = {};
      allData.forEach(r => {
        depts[r.department] = (depts[r.department] || 0) + 1;
        caps[r.capacity] = (caps[r.capacity] || 0) + 1;
      });

      renderChart('deptChart', Object.keys(depts), Object.values(depts), 'bar');
      renderChart('capChart', Object.keys(caps), Object.values(caps), 'pie');
    }

    function renderChart(id, labels, data, type) {
      if(charts[id]) charts[id].destroy();
      charts[id] = new Chart(document.getElementById(id), {
        type: type,
        data: {
          labels: labels,
          datasets: [{ data: data, backgroundColor: ['#379777', '#f4ce14', '#45474b', '#ff6384', '#36a2eb'] }]
        },
        options: { responsive: true, maintainAspectRatio: false }
      });
    }

    function showLoading(show) {
      document.getElementById('loading').style.display = show ? 'flex' : 'none';
    }

    // Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„
    window.onload = loadData;
  </script>
 </body>
</html>
